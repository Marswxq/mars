import{_ as n,c as a,d as p,o as e}from"./app-CKtXyHQO.js";const t={};function o(l,s){return e(),a("div",null,s[0]||(s[0]=[p(`<h1 id="doris-安装" tabindex="-1"><a class="header-anchor" href="#doris-安装"><span>Doris 安装</span></a></h1><h2 id="doris-镜像构建" tabindex="-1"><a class="header-anchor" href="#doris-镜像构建"><span>Doris 镜像构建</span></a></h2><h3 id="软硬件要求" tabindex="-1"><a class="header-anchor" href="#软硬件要求"><span>软硬件要求</span></a></h3><p><strong>硬件要求</strong></p><p>推荐配置：4 核 16GB 内存</p><p><strong>软件要求</strong></p><p>Docker Version：20.10 及以后版本</p><h3 id="构建-fe-镜像" tabindex="-1"><a class="header-anchor" href="#构建-fe-镜像"><span>构建 FE 镜像</span></a></h3><h4 id="_1-fe-镜像的环境目录" tabindex="-1"><a class="header-anchor" href="#_1-fe-镜像的环境目录"><span>1. FE 镜像的环境目录</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/doris/docker-build/fe/dockerfile /data/doris/docker-build/fe/resource</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>目录结构</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">└── docker-build                                                // 构建根目录 </span>
<span class="line">    └── fe                                                   // Doris 构建目录</span>
<span class="line">        ├── Dockerfile                                          // Dockerfile 脚本</span>
<span class="line">        └── resource                                            // 资源目录</span>
<span class="line">            ├── init_fe.sh                                      // FE 启动及注册脚本</span>
<span class="line">            └── apache-doris-2.0.3-bin.tar.gz                   // 二进制程序包</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-dockerfile" tabindex="-1"><a class="header-anchor" href="#_2-dockerfile"><span>2. Dockerfile</span></a></h4><ul><li>创建Dockerfile</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 创建文件</span></span>
<span class="line"><span class="token function">touch</span> /data/doris/docker-build/fe/Dockerfile</span>
<span class="line"><span class="token comment"># 编辑文件</span></span>
<span class="line"><span class="token function">vim</span> /data/doris/docker-build/fe/Dockerfile</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Dockerfile 内容</li></ul><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token comment"># 选择基础镜像</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> openjdk:8u342-jdk</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置环境变量</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENV</span> JAVA_HOME=<span class="token string">&quot;/usr/local/openjdk-8/&quot;</span></span></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENV</span> PATH=<span class="token string">&quot;/opt/apache-doris/fe/bin:$PATH&quot;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 下载软件至镜像内，可根据需要替换</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">ADD</span> ./resource/apache-doris-2.0.13-bin-x64.tar.gz /opt/</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get install -y default-mysql-client &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get clean &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    mkdir /opt/apache-doris &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    cd /opt &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    mv apache-doris-2.0.13-bin-x64/fe /opt/apache-doris/</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">ADD</span> ./resource/init_fe.sh /opt/apache-doris/fe/bin</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> chmod 755 /opt/apache-doris/fe/bin/init_fe.sh</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/opt/apache-doris/fe/bin/init_fe.sh&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-init-fe-sh" tabindex="-1"><a class="header-anchor" href="#_3-init-fe-sh"><span>3. init_fe.sh</span></a></h4><ul><li>创建 init_fe.sh</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 创建文件</span></span>
<span class="line"><span class="token function">touch</span> /data/doris/docker-build/fe/resource/init_fe.sh</span>
<span class="line"><span class="token comment"># 编辑文件</span></span>
<span class="line"><span class="token function">vim</span> /data/doris/docker-build/fe/resource/init_fe.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>init_fe.sh 内容</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token comment"># Licensed to the Apache Software Foundation (ASF) under one</span></span>
<span class="line"><span class="token comment"># or more contributor license agreements.  See the NOTICE file</span></span>
<span class="line"><span class="token comment"># distributed with this work for additional information</span></span>
<span class="line"><span class="token comment"># regarding copyright ownership.  The ASF licenses this file</span></span>
<span class="line"><span class="token comment"># to you under the Apache License, Version 2.0 (the</span></span>
<span class="line"><span class="token comment"># &quot;License&quot;); you may not use this file except in compliance</span></span>
<span class="line"><span class="token comment"># with the License.  You may obtain a copy of the License at</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment">#   http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Unless required by applicable law or agreed to in writing,</span></span>
<span class="line"><span class="token comment"># software distributed under the License is distributed on an</span></span>
<span class="line"><span class="token comment"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span>
<span class="line"><span class="token comment"># KIND, either express or implied.  See the License for the</span></span>
<span class="line"><span class="token comment"># specific language governing permissions and limitations</span></span>
<span class="line"><span class="token comment"># under the License.</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">set</span> <span class="token parameter variable">-eo</span> pipefail</span>
<span class="line"><span class="token builtin class-name">shopt</span> <span class="token parameter variable">-s</span> nullglob</span>
<span class="line"></span>
<span class="line"><span class="token assign-left variable">DORIS_HOME</span><span class="token operator">=</span><span class="token string">&quot;/opt/apache-doris&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Obtain necessary and basic information to complete initialization</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># logging functions</span></span>
<span class="line"><span class="token comment"># usage: doris_[note|warn|error] $log_meg</span></span>
<span class="line"><span class="token comment">#    ie: doris_warn &quot;task may fe risky!&quot;</span></span>
<span class="line"><span class="token comment">#   out: 2023-01-08T19:08:16+08:00 [Warn] [Entrypoint]: task may fe risky!</span></span>
<span class="line"><span class="token function-name function">doris_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin class-name">local</span> <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span></span>
<span class="line">    <span class="token builtin class-name">shift</span></span>
<span class="line">    <span class="token comment"># accept argument string or stdin</span></span>
<span class="line">    <span class="token builtin class-name">local</span> <span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$*</span>&quot;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$#</span>&quot;</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span><span class="token variable">)</span></span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">fi</span></span>
<span class="line">    <span class="token builtin class-name">local</span> <span class="token assign-left variable">dt</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-Iseconds</span><span class="token variable">)</span></span>&quot;</span></span>
<span class="line">    <span class="token builtin class-name">printf</span> <span class="token string">&#39;%s [%s] [Entrypoint]: %s\\n&#39;</span> <span class="token string">&quot;<span class="token variable">$dt</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$type</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$text</span>&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function-name function">doris_note</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    doris_log Note <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function-name function">doris_warn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    doris_log Warn <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function-name function">doris_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    doris_log ERROR <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span></span>
<span class="line">    <span class="token builtin class-name">exit</span> <span class="token number">1</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># check to see if this file is being run or sourced from another script</span></span>
<span class="line"><span class="token function-name function">_is_sourced</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">\${<span class="token operator">#</span>FUNCNAME<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span> <span class="token parameter variable">-ge</span> <span class="token number">2</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">        <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">\${FUNCNAME<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&#39;_is_sourced&#39;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">        <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">\${FUNCNAME<span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&#39;source&#39;</span> <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function-name function">docker_setup_env</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin class-name">declare</span> <span class="token parameter variable">-g</span> DATABASE_ALREADY_EXISTS BUILD_TYPE_K8S PRIORITY_NETWORKS_EXISTS</span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token string">&quot;<span class="token variable">\${DORIS_HOME}</span>/fe/doris-meta/image&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        doris_note <span class="token string">&quot;the image is exsit!&quot;</span></span>
<span class="line">        <span class="token assign-left variable">DATABASE_ALREADY_EXISTS</span><span class="token operator">=</span><span class="token string">&#39;true&#39;</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">&quot;<span class="token variable">$PRIORITY_NETWORKS</span>&quot;</span> <span class="token string">&quot;<span class="token variable">\${DORIS_HOME}</span>/fe/conf/fe.conf&quot;</span> <span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        doris_note <span class="token string">&quot;the priority_networks is exsit!&quot;</span></span>
<span class="line">        <span class="token assign-left variable">PRIORITY_NETWORKS_EXISTS</span><span class="token operator">=</span><span class="token string">&#39;true&#39;</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">        doris_note <span class="token string">&quot;the priority_networks values is <span class="token variable">$PRIORITY_NETWORKS</span>&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;the conf file path is <span class="token variable">\${DORIS_HOME}</span>/fe/conf/fe.conf&quot;</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check the variables required for   startup</span></span>
<span class="line"><span class="token function-name function">docker_required_variables_env</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin class-name">declare</span> <span class="token parameter variable">-g</span> RUN_TYPE</span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$BUILD_TYPE</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token assign-left variable">RUN_TYPE</span><span class="token operator">=</span><span class="token string">&quot;K8S&quot;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$BUILD_TYPE</span> <span class="token operator">=~</span> ^<span class="token punctuation">(</span><span class="token punctuation">[</span>kK<span class="token punctuation">]</span><span class="token number">8</span><span class="token punctuation">[</span>sS<span class="token punctuation">]</span><span class="token punctuation">)</span>$ <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            doris_warn <span class="token string">&quot;BUILD_TYPE&quot;</span> <span class="token variable">$BUILD_TYPE</span></span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">            doris_error <span class="token string">&quot;BUILD_TYPE rule error！example: [k8s], Default Value: docker.&quot;</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        <span class="token builtin class-name">return</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$FE_SERVERS</span>&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$BE_SERVERS</span>&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$FE_ID</span>&quot;</span>  <span class="token operator">&amp;&amp;</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$FQDN</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token assign-left variable">RUN_TYPE</span><span class="token operator">=</span><span class="token string">&quot;FQDN&quot;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$FE_SERVERS</span> <span class="token operator">=~</span> ^<span class="token punctuation">[</span>a-zA-Z<span class="token punctuation">]</span>.+:<span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">\\</span>.<span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span>:<span class="token punctuation">[</span><span class="token number">1</span>-6<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1,4</span><span class="token punctuation">}</span><span class="token punctuation">(</span>,<span class="token punctuation">[</span>a-zA-Z<span class="token punctuation">]</span>+<span class="token punctuation">\\</span>w+:<span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">\\</span>.<span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span>:<span class="token punctuation">[</span><span class="token number">1</span>-6<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0,1</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1,4</span><span class="token punctuation">}</span><span class="token punctuation">)</span>*$ <span class="token operator">||</span> <span class="token variable">$FE_SERVERS</span> <span class="token operator">=~</span> ^<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>-9a-fA-F<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1,4</span><span class="token punctuation">}</span>:<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">7,7</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>-9a-fA-F<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1,4</span><span class="token punctuation">}</span><span class="token operator">|</span><span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>-9a-fA-F<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1,4</span><span class="token punctuation">}</span>:<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">1,6</span><span class="token punctuation">}</span><span class="token punctuation">(</span>:<span class="token punctuation">[</span><span class="token number">0</span>-9a-fA-F<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1,4</span><span class="token punctuation">}</span><span class="token operator">|</span><span class="token builtin class-name">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>-9a-fA-F<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1,4</span><span class="token punctuation">}</span>:<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">1,5</span><span class="token punctuation">}</span><span class="token variable"><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span>$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_SERVERS &quot; $FE_SERVERS</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_SERVERS rule error！example<span class="token operator">:</span> \\$FE_NAME<span class="token operator">:</span>\\$FE_HOST_IP<span class="token operator">:</span>\\$FE_EDIT_LOG_PORT[<span class="token punctuation">,</span>\\$FE_NAME<span class="token operator">:</span>\\$FE_HOST_IP<span class="token operator">:</span>\\$FE_EDIT_LOG_PORT]... AND FE_NAME Ruler is &#39;[a<span class="token operator">-</span>zA<span class="token operator">-</span>Z].<span class="token operator">+</span>&#39;<span class="token operator">!</span>&quot;</span>
<span class="line">        fi</span>
<span class="line">        if [[ $FE_ID <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_ID &quot; $FE_ID</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_ID rule error！If FE is the role of Master<span class="token punctuation">,</span> please set FE_ID<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> and ensure that all IDs correspond to the IP of the current node<span class="token punctuation">,</span> ID start num is <span class="token number">1.</span>&quot;</span>
<span class="line">        fi</span>
<span class="line">        if [[ $BE_SERVERS <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>[a<span class="token operator">-</span>zA<span class="token operator">-</span>Z].<span class="token operator">+</span><span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">(</span>\\.[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">)</span>{<span class="token number">3</span>}<span class="token punctuation">(</span><span class="token punctuation">,</span>[a<span class="token operator">-</span>zA<span class="token operator">-</span>Z]<span class="token operator">+</span>\\w<span class="token operator">+</span><span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">(</span>\\.[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">)</span>{<span class="token number">3</span>}<span class="token punctuation">)</span><span class="token operator">*</span>$ <span class="token operator">||</span> $FE_SERVERS <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token punctuation">(</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span>$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;BE_SERVERS &quot; $BE_SERVERS</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;BE_SERVERS rule error！example<span class="token operator">:</span> \\$BE_NODE_NAME<span class="token operator">:</span>\\$BE_HOST_IP[<span class="token punctuation">,</span>\\$BE_NODE_NAME<span class="token operator">:</span>\\$BE_HOST_IP<span class="token operator">:</span>]... AND BE_NODE_NAME Ruler is &#39;[a<span class="token operator">-</span>zA<span class="token operator">-</span>Z].<span class="token operator">+</span>&#39;<span class="token operator">!</span>&quot;</span>
<span class="line">        fi</span>
<span class="line">        return</span>
<span class="line">    fi</span>
<span class="line"></span>
<span class="line">    if [[ <span class="token operator">-</span>n &quot;$RECOVERY&quot; <span class="token operator">&amp;&amp;</span> <span class="token operator">-</span>n &quot;$FE_SERVERS&quot; <span class="token operator">&amp;&amp;</span> <span class="token operator">-</span>n &quot;$FE_ID&quot; ]]<span class="token punctuation">;</span> then</span>
<span class="line">        RUN_TYPE<span class="token operator">=</span>&quot;RECOVERY&quot;</span>
<span class="line">        if [[ $RECOVERY <span class="token operator">=</span><span class="token operator">~</span> true ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;RECOVERY &quot; $RECOVERY</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;RECOVERY value error<span class="token operator">!</span> Only Support &#39;true&#39;<span class="token operator">!</span>&quot;</span>
<span class="line">        fi</span>
<span class="line">        if [[ $FE_SERVERS <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>.<span class="token operator">+</span><span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">(</span>\\.[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">)</span>{<span class="token number">3</span>}<span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">6</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">(</span><span class="token punctuation">,</span>.<span class="token operator">+</span><span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">(</span>\\.[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">)</span>{<span class="token number">3</span>}<span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">6</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span><span class="token operator">*</span>$ <span class="token operator">||</span> $FE_SERVERS <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token punctuation">(</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span>$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_SERVERS &quot; $FE_SERVERS</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_SERVERS rule error！example<span class="token operator">:</span> \\$FE_NAME<span class="token operator">:</span>\\$FE_HOST_IP<span class="token operator">:</span>\\$FE_EDIT_LOG_PORT[<span class="token punctuation">,</span>\\$FE_NAME<span class="token operator">:</span>\\$FE_HOST_IP<span class="token operator">:</span>\\$FE_EDIT_LOG_PORT]...&quot;</span>
<span class="line">        fi</span>
<span class="line">        if [[ $FE_ID <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_ID&quot; $FE_ID</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_ID rule error！If FE is the role of Master<span class="token punctuation">,</span> please set FE_ID<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> and ensure that all IDs correspond to the IP of the current node.&quot;</span>
<span class="line">        fi</span>
<span class="line">        doris_warn &quot;The Frontend MetaData Will Recovery.&quot;</span>
<span class="line">        return</span>
<span class="line">    fi</span>
<span class="line"></span>
<span class="line">    if [[ <span class="token operator">-</span>n &quot;$FE_SERVERS&quot; <span class="token operator">&amp;&amp;</span> <span class="token operator">-</span>n &quot;$FE_ID&quot; ]]<span class="token punctuation">;</span> then</span>
<span class="line">        RUN_TYPE<span class="token operator">=</span>&quot;ELECTION&quot;</span>
<span class="line">        if [[ $FE_SERVERS <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>.<span class="token operator">+</span><span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">(</span>\\.[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">)</span>{<span class="token number">3</span>}<span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">6</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">(</span><span class="token punctuation">,</span>.<span class="token operator">+</span><span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">(</span>\\.[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">)</span>{<span class="token number">3</span>}<span class="token operator">:</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">6</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span><span class="token operator">*</span>$ <span class="token operator">||</span> $FE_SERVERS <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token punctuation">(</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span>$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_SERVERS&quot; $FE_SERVERS</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_SERVERS rule error！example<span class="token operator">:</span> \\$FE_NAME<span class="token operator">:</span>\\$FE_HOST_IP<span class="token operator">:</span>\\$FE_EDIT_LOG_PORT[<span class="token punctuation">,</span>\\$FE_NAME<span class="token operator">:</span>\\$FE_HOST_IP<span class="token operator">:</span>\\$FE_EDIT_LOG_PORT]...&quot;</span>
<span class="line">        fi</span>
<span class="line">        if [[ $FE_ID <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_ID&quot; $FE_ID</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_ID rule error！If FE is the role of Master<span class="token punctuation">,</span> please set FE_ID<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> and ensure that all IDs correspond to the IP of the current node.&quot;</span>
<span class="line">        fi</span>
<span class="line">        return</span>
<span class="line">    fi</span>
<span class="line"></span>
<span class="line">    if [[ <span class="token operator">-</span>n &quot;$FE_MASTER_IP&quot; <span class="token operator">&amp;&amp;</span> <span class="token operator">-</span>n &quot;$FE_MASTER_PORT&quot; <span class="token operator">&amp;&amp;</span> <span class="token operator">-</span>n &quot;$FE_CURRENT_IP&quot; <span class="token operator">&amp;&amp;</span> <span class="token operator">-</span>n &quot;$FE_CURRENT_PORT&quot; ]]<span class="token punctuation">;</span> then</span>
<span class="line">        RUN_TYPE<span class="token operator">=</span>&quot;ASSIGN&quot;</span>
<span class="line">        if [[ $FE_MASTER_IP <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">(</span>\\.[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">)</span>{<span class="token number">3</span>}$ <span class="token operator">||</span> $FE_MASTER_IP <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token punctuation">(</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span>$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_MASTER_IP&quot; $FE_MASTER_IP</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_MASTER_IP rule error！example<span class="token operator">:</span> \\$FE_MASTER_IP&quot;</span>
<span class="line">        fi</span>
<span class="line">        if [[ $FE_MASTER_PORT <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">6</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_MASTER_PORT&quot; $FE_MASTER_PORT</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_MASTER_PORT rule error！example<span class="token operator">:</span> \\$FE_MASTER_EDIT_LOG_HOST.&quot;</span>
<span class="line">        fi</span>
<span class="line">        if [[ $FE_CURRENT_IP <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">(</span>\\.[<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span>}<span class="token punctuation">)</span>{<span class="token number">3</span>}$ <span class="token operator">||</span> $FE_CURRENT_IP <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token punctuation">(</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>}<span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">((</span><span class="token operator">:</span>[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>a<span class="token operator">-</span>fA<span class="token operator">-</span>F]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}<span class="token punctuation">)</span>{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span>}<span class="token operator">|</span><span class="token operator">:</span><span class="token punctuation">)</span>$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_CURRENT_IP&quot; $FE_CURRENT_IP</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_CURRENT_IP rule error！example<span class="token operator">:</span> \\$FE_CURRENT_IP&quot;</span>
<span class="line">        fi</span>
<span class="line">        if [[ $FE_CURRENT_PORT <span class="token operator">=</span><span class="token operator">~</span> <span class="token operator">^</span>[<span class="token number">1</span><span class="token operator">-</span><span class="token number">6</span>]{<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>}[<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>]{<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>}$ ]]<span class="token punctuation">;</span> then</span>
<span class="line">            doris_warn &quot;FE_CURRENT_PORT&quot; $FE_CURRENT_PORT</span>
<span class="line">        else</span>
<span class="line">            doris_error &quot;FE_CURRENT_PORT rule error！example<span class="token operator">:</span> \\$FE_CURRENT_EDIT_LOG_HOST.&quot;</span>
<span class="line">        fi</span>
<span class="line">        return</span>
<span class="line">    fi</span>
<span class="line"></span>
<span class="line">    doris_error EOF &quot;</span>
<span class="line">                 Note that you did not configure the required parameters<span class="token operator">!</span></span>
<span class="line">                 plan <span class="token number">1</span><span class="token operator">:</span></span>
<span class="line">                 BUILD_TYPE</span>
<span class="line">                 plan <span class="token number">2</span><span class="token operator">:</span></span>
<span class="line">                 RECOVERY <span class="token operator">&amp;</span> FE_SERVERS <span class="token operator">&amp;</span> FE_ID</span>
<span class="line">                 plan <span class="token number">3</span><span class="token operator">:</span></span>
<span class="line">                 FE_SERVERS <span class="token operator">&amp;</span> FE_ID</span>
<span class="line">                 plan <span class="token number">4</span><span class="token operator">:</span></span>
<span class="line">                 FE_SERVERS <span class="token operator">&amp;</span> FE_ID <span class="token operator">&amp;</span> BE_SERVERS <span class="token operator">&amp;</span> FQDN</span>
<span class="line">                 plan <span class="token number">5</span><span class="token operator">:</span></span>
<span class="line">                 FE_MASTER_IP <span class="token operator">&amp;</span> FE_MASTER_PORT <span class="token operator">&amp;</span> FE_CURRENT_IP <span class="token operator">&amp;</span> FE_CURRENT_PORT&quot;</span>
<span class="line">                EOF</span>
<span class="line"></span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">get_doris_fe_args<span class="token punctuation">(</span><span class="token punctuation">)</span> {</span>
<span class="line">    declare <span class="token operator">-</span>g MASTER_FE_IP CURRENT_FE_IP CURRENT_NODE_NAME MASTER_FE_EDIT_PORT MASTER_NODE_NAME CURRENT_FE_EDIT_PORT PRIORITY_NETWORKS CURRENT_FE_IS_MASTER FE_HOSTS_MSG BE_HOSTS_MSG</span>
<span class="line">    if [[ $RUN_TYPE <span class="token operator">==</span> &quot;ELECTION&quot; <span class="token operator">||</span> $RUN_TYPE <span class="token operator">==</span> &quot;RECOVERY&quot; ]]<span class="token punctuation">;</span> then</span>
<span class="line">        local feServerArray<span class="token operator">=</span><span class="token punctuation">(</span>$<span class="token punctuation">(</span>echo &quot;\${FE_SERVERS}&quot; <span class="token operator">|</span> awk &#39;{gsub <span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">,</span><span class="token operator">/</span><span class="token punctuation">,</span>&quot; &quot;<span class="token punctuation">)</span><span class="token punctuation">;</span> print $<span class="token number">0</span>}&#39;<span class="token punctuation">))</span></span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable">\${feServerArray<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">            <span class="token assign-left variable">val</span><span class="token operator">=</span><span class="token variable">\${i}</span></span>
<span class="line">            <span class="token assign-left variable">val</span><span class="token operator">=</span><span class="token variable">\${val<span class="token operator">/</span><span class="token operator">/</span> <span class="token operator">/</span>}</span></span>
<span class="line">            <span class="token assign-left variable">tmpFeName</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${val}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;:&#39;</span> <span class="token string">&#39;{ sub(/ /, &quot;&quot;); print$1}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">            <span class="token assign-left variable">tmpFeIp</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${val}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;:&#39;</span> <span class="token string">&#39;{ sub(/ /, &quot;&quot;); print$2}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">            <span class="token assign-left variable">tmpFeEditLogPort</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${val}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;:&#39;</span> <span class="token string">&#39;{ sub(/ /, &quot;&quot;); print$3}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">            check_arg <span class="token string">&quot;TMP_FE_IP&quot;</span> <span class="token variable">$tmpFeIp</span></span>
<span class="line">            <span class="token assign-left variable">feIpArray</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$tmpFeIp</span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            check_arg <span class="token string">&quot;TMP_FE_EDIT_LOG_PORT&quot;</span> <span class="token variable">$tmpFeEditLogPort</span></span>
<span class="line">            <span class="token assign-left variable">feEditLogPortArray</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$tmpFeEditLogPort</span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">done</span></span>
<span class="line"></span>
<span class="line">        <span class="token assign-left variable">MASTER_FE_IP</span><span class="token operator">=</span><span class="token variable">\${feIpArray<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;MASTER_FE_IP&quot;</span> <span class="token variable">$MASTER_FE_IP</span></span>
<span class="line">        <span class="token assign-left variable">MASTER_FE_EDIT_PORT</span><span class="token operator">=</span><span class="token variable">\${feEditLogPortArray<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;MASTER_FE_EDIT_PORT&quot;</span> <span class="token variable">$MASTER_FE_EDIT_PORT</span></span>
<span class="line">        <span class="token assign-left variable">CURRENT_FE_IP</span><span class="token operator">=</span><span class="token variable">\${feIpArray<span class="token punctuation">[</span>$FE_ID-1<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;CURRENT_FE_IP&quot;</span> <span class="token variable">$CURRENT_FE_IP</span></span>
<span class="line">        <span class="token assign-left variable">CURRENT_FE_EDIT_PORT</span><span class="token operator">=</span><span class="token variable">\${feEditLogPortArray<span class="token punctuation">[</span>$FE_ID-1<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;CURRENT_FE_EDIT_PORT&quot;</span> <span class="token variable">$CURRENT_FE_EDIT_PORT</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">\${MASTER_FE_IP}</span> <span class="token operator">==</span> <span class="token variable">\${CURRENT_FE_IP}</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            <span class="token assign-left variable">CURRENT_FE_IS_MASTER</span><span class="token operator">=</span>true</span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">            <span class="token assign-left variable">CURRENT_FE_IS_MASTER</span><span class="token operator">=</span>false</span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line">        <span class="token assign-left variable">PRIORITY_NETWORKS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${CURRENT_FE_IP}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;.&#39;</span> <span class="token string">&#39;{print$1&quot;.&quot;$2&quot;.&quot;$3&quot;.0/24&quot;}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">        check_arg <span class="token string">&quot;PRIORITY_NETWORKS&quot;</span> <span class="token variable">$PRIORITY_NETWORKS</span></span>
<span class="line"></span>
<span class="line">        doris_note <span class="token string">&quot;FE_IP_ARRAY = [<span class="token variable">\${feIpArray<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>]&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;FE_EDIT_LOG_PORT_ARRAY = [<span class="token variable">\${feEditLogPortArray<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>]&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;MASTER_FE = <span class="token variable">\${MASTER_FE_IP}</span>:<span class="token variable">\${MASTER_FE_EDIT_PORT}</span>&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;CURRENT_FE = <span class="token variable">\${CURRENT_FE_IP}</span>:<span class="token variable">\${CURRENT_FE_EDIT_PORT}</span>&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;PRIORITY_NETWORKS = <span class="token variable">\${PRIORITY_NETWORKS}</span>&quot;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;FQDN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token builtin class-name">local</span> <span class="token assign-left variable">feServerArray</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${FE_SERVERS}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{gsub (/,/,&quot; &quot;); print $0}&#39;</span><span class="token variable">)</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token builtin class-name">local</span> <span class="token assign-left variable">beServerArray</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${BE_SERVERS}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{gsub (/,/,&quot; &quot;); print $0}&#39;</span><span class="token variable">)</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token assign-left variable">feIpArray</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token assign-left variable">feEditLogPortArray</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token assign-left variable">feNameArray</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token assign-left variable">beIpArray</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token assign-left variable">beNameArray</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>\${#feServerArray[@]}<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">            <span class="token assign-left variable">val</span><span class="token operator">=</span><span class="token variable">\${feServerArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span>}</span></span>
<span class="line">            <span class="token assign-left variable">val</span><span class="token operator">=</span><span class="token variable">\${val<span class="token operator">/</span><span class="token operator">/</span> <span class="token operator">/</span>}</span></span>
<span class="line">            <span class="token assign-left variable">tmpFeName</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${val}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;:&#39;</span> <span class="token string">&#39;{ sub(/ /, &quot;&quot;); print$1}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">            <span class="token assign-left variable">tmpFeIp</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${val}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;:&#39;</span> <span class="token string">&#39;{ sub(/ /, &quot;&quot;); print$2}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">            <span class="token assign-left variable">tmpFeEditLogPort</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${val}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;:&#39;</span> <span class="token string">&#39;{ sub(/ /, &quot;&quot;); print$3}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">            check_arg <span class="token string">&quot;TMP_FE_NAME&quot;</span> <span class="token variable">$tmpFeName</span></span>
<span class="line">            <span class="token assign-left variable">feNameArray</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$tmpFeName</span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            check_arg <span class="token string">&quot;TMP_FE_IP&quot;</span> <span class="token variable">$tmpFeIp</span></span>
<span class="line">            <span class="token assign-left variable">feIpArray</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$tmpFeIp</span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            check_arg <span class="token string">&quot;TMP_FE_EDIT_LOG_PORT&quot;</span> <span class="token variable">$tmpFeEditLogPort</span></span>
<span class="line">            <span class="token assign-left variable">feEditLogPortArray</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$tmpFeEditLogPort</span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token assign-left variable">FE_HOSTS_MSG</span><span class="token operator">+=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> <span class="token string">&quot;%s<span class="token entity" title="\\t">\\t</span>%s&quot;</span> $tmpFeIp $tmpFeName<span class="token variable">)</span></span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-lt</span> <span class="token variable"><span class="token variable">$((</span>\${#feServerArray[@]}<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                <span class="token assign-left variable">FE_HOSTS_MSG</span><span class="token operator">+=</span><span class="token string">&#39;\\n&#39;</span></span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">done</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>\${#beServerArray[@]}<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">            <span class="token assign-left variable">val</span><span class="token operator">=</span><span class="token variable">\${beServerArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span>}</span></span>
<span class="line">            <span class="token assign-left variable">val</span><span class="token operator">=</span><span class="token variable">\${val<span class="token operator">/</span><span class="token operator">/</span> <span class="token operator">/</span>}</span></span>
<span class="line">            <span class="token assign-left variable">tmpBeName</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${val}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;:&#39;</span> <span class="token string">&#39;{ sub(/fe/, &quot;&quot;); sub(/ /, &quot;&quot;); print$1}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">            <span class="token assign-left variable">tmpBeIp</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${val}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;:&#39;</span> <span class="token string">&#39;{ sub(/ /, &quot;&quot;); print$2}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">            check_arg <span class="token string">&quot;TMP_BE_NAME&quot;</span> <span class="token variable">$tmpBeName</span></span>
<span class="line">            <span class="token assign-left variable">beNameArray</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$tmpBeName</span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            check_arg <span class="token string">&quot;TMP_BE_IP&quot;</span> <span class="token variable">$tmpBeIp</span></span>
<span class="line">            <span class="token assign-left variable">beIpArray</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$tmpBeIp</span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token assign-left variable">BE_HOSTS_MSG</span><span class="token operator">+=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> <span class="token string">&quot;%s<span class="token entity" title="\\t">\\t</span>%s&quot;</span> $tmpBeIp $tmpBeName<span class="token variable">)</span></span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-lt</span> <span class="token variable"><span class="token variable">$((</span>\${#beServerArray[@]}<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                <span class="token assign-left variable">BE_HOSTS_MSG</span><span class="token operator">+=</span><span class="token string">&#39;\\n&#39;</span></span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">done</span></span>
<span class="line"></span>
<span class="line">        <span class="token assign-left variable">MASTER_FE_IP</span><span class="token operator">=</span><span class="token variable">\${feIpArray<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;MASTER_FE_IP&quot;</span> <span class="token variable">$MASTER_FE_IP</span></span>
<span class="line">        <span class="token assign-left variable">MASTER_FE_EDIT_PORT</span><span class="token operator">=</span><span class="token variable">\${feEditLogPortArray<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;MASTER_FE_EDIT_PORT&quot;</span> <span class="token variable">$MASTER_FE_EDIT_PORT</span></span>
<span class="line">        <span class="token assign-left variable">MASTER_NODE_NAME</span><span class="token operator">=</span><span class="token variable">\${feNameArray<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;MASTER_NODE_NAME&quot;</span> <span class="token variable">$MASTER_NODE_NAME</span></span>
<span class="line">        <span class="token assign-left variable">CURRENT_NODE_NAME</span><span class="token operator">=</span><span class="token variable">\${feNameArray<span class="token punctuation">[</span>$FE_ID-1<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;CURRENT_NODE_NAME&quot;</span> <span class="token variable">$CURRENT_NODE_NAME</span></span>
<span class="line">        <span class="token assign-left variable">CURRENT_FE_IP</span><span class="token operator">=</span><span class="token variable">\${feIpArray<span class="token punctuation">[</span>$FE_ID-1<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;CURRENT_FE_IP&quot;</span> <span class="token variable">$CURRENT_FE_IP</span></span>
<span class="line">        <span class="token assign-left variable">CURRENT_FE_EDIT_PORT</span><span class="token operator">=</span><span class="token variable">\${feEditLogPortArray<span class="token punctuation">[</span>$FE_ID-1<span class="token punctuation">]</span>}</span></span>
<span class="line">        check_arg <span class="token string">&quot;CURRENT_FE_EDIT_PORT&quot;</span> <span class="token variable">$CURRENT_FE_EDIT_PORT</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">\${MASTER_FE_IP}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;<span class="token variable">\${CURRENT_FE_IP}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            <span class="token assign-left variable">CURRENT_FE_IS_MASTER</span><span class="token operator">=</span>true</span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">            <span class="token assign-left variable">CURRENT_FE_IS_MASTER</span><span class="token operator">=</span>false</span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Print arrays with desired format</span></span>
<span class="line">        doris_note <span class="token string">&quot;FE_HOSTS_MSG = [<span class="token entity" title="\\n">\\n</span><span class="token variable">\${FE_HOSTS_MSG}</span><span class="token entity" title="\\n">\\n</span>]&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;BE_HOSTS_MSG = [<span class="token entity" title="\\n">\\n</span><span class="token variable">\${BE_HOSTS_MSG}</span><span class="token entity" title="\\n">\\n</span>]&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;FE_NAME_ARRAY = [<span class="token variable">\${feNameArray<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>]&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;FE_IP_ARRAY = [<span class="token variable">\${feIpArray<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>]&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;FE_EDIT_LOG_PORT_ARRAY = [<span class="token variable">\${feEditLogPortArray<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>]&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;MASTER_FE = <span class="token variable">\${MASTER_FE_IP}</span>:<span class="token variable">\${MASTER_FE_EDIT_PORT}</span>&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;MASTEMASTER_NODE_NAMER_FE = <span class="token variable">\${MASTER_NODE_NAME}</span>&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;CURRENT_NODE_NAME = <span class="token variable">\${CURRENT_NODE_NAME}</span>&quot;</span></span>
<span class="line">        doris_note <span class="token string">&quot;CURRENT_FE = <span class="token variable">\${CURRENT_FE_IP}</span>:<span class="token variable">\${CURRENT_FE_EDIT_PORT}</span>&quot;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token assign-left variable">MASTER_FE_IP</span><span class="token operator">=</span><span class="token variable">\${FE_MASTER_IP}</span></span>
<span class="line">        check_arg <span class="token string">&quot;MASTER_FE_IP&quot;</span> <span class="token variable">$MASTER_FE_IP</span></span>
<span class="line">        <span class="token assign-left variable">MASTER_FE_EDIT_PORT</span><span class="token operator">=</span><span class="token variable">\${FE_MASTER_PORT}</span></span>
<span class="line">        check_arg <span class="token string">&quot;MASTER_FE_EDIT_PORT&quot;</span> <span class="token variable">$MASTER_FE_EDIT_PORT</span></span>
<span class="line">        <span class="token assign-left variable">CURRENT_FE_IP</span><span class="token operator">=</span><span class="token variable">\${FE_CURRENT_IP}</span></span>
<span class="line">        check_arg <span class="token string">&quot;CURRENT_FE_IP&quot;</span> <span class="token variable">$CURRENT_FE_IP</span></span>
<span class="line">        <span class="token assign-left variable">CURRENT_FE_EDIT_PORT</span><span class="token operator">=</span><span class="token variable">\${FE_CURRENT_PORT}</span></span>
<span class="line">        check_arg <span class="token string">&quot;CURRENT_FE_EDIT_PORT&quot;</span> <span class="token variable">$CURRENT_FE_EDIT_PORT</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">\${MASTER_FE_IP}</span> <span class="token operator">==</span> <span class="token variable">\${CURRENT_FE_IP}</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            <span class="token assign-left variable">CURRENT_FE_IS_MASTER</span><span class="token operator">=</span>true</span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">            <span class="token assign-left variable">CURRENT_FE_IS_MASTER</span><span class="token operator">=</span>false</span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line">        <span class="token assign-left variable">PRIORITY_NETWORKS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${CURRENT_FE_IP}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&#39;.&#39;</span> <span class="token string">&#39;{print$1&quot;.&quot;$2&quot;.&quot;$3&quot;.0/24&quot;}&#39;</span><span class="token variable">)</span></span></span>
<span class="line">        check_arg <span class="token string">&quot;PRIORITY_NETWORKS&quot;</span> <span class="token variable">$PRIORITY_NETWORKS</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># check fe start</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ELECTION&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        check_fe_status <span class="token boolean">true</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function-name function">add_priority_networks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    doris_note <span class="token string">&quot;add priority_networks <span class="token variable">\${1}</span> to <span class="token variable">\${DORIS_HOME}</span>/fe/conf/fe.conf&quot;</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">&quot;priority_networks = <span class="token variable">\${1}</span>&quot;</span> <span class="token operator">&gt;&gt;</span><span class="token variable">\${DORIS_HOME}</span>/fe/conf/fe.conf</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function-name function">add_fqdn_conf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    doris_note <span class="token string">&quot;add ‘enable_fqdn_mode = true’ to <span class="token variable">\${DORIS_HOME}</span>/fe/conf/fe.conf&quot;</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">&quot;enable_fqdn_mode = true&quot;</span> <span class="token operator">&gt;&gt;</span><span class="token variable">\${DORIS_HOME}</span>/fe/conf/fe.conf</span>
<span class="line">    doris_note <span class="token string">&quot;add &#39;FE hosts msg&#39; <span class="token entity" title="\\n">\\n</span><span class="token variable">\${FE_HOSTS_MSG}</span> to /etc/hosts&quot;</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">\${FE_HOSTS_MSG}</span> <span class="token operator">&gt;</span>/etc/hosts</span>
<span class="line">    doris_note <span class="token string">&quot;add &#39;BE hosts msg&#39; <span class="token entity" title="\\n">\\n</span><span class="token variable">\${BE_HOSTS_MSG}</span> to /etc/hosts&quot;</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token variable">\${BE_HOSTS_MSG}</span> <span class="token operator">&gt;&gt;</span>/etc/hosts</span>
<span class="line">    doris_note <span class="token string">&quot;add &#39;host_name = <span class="token variable">\${CURRENT_NODE_NAME}</span>&#39; to /etc/hostname&quot;</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token variable">\${CURRENT_NODE_NAME}</span> <span class="token operator">&gt;</span>/etc/hostname</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Execute sql script, passed via stdin</span></span>
<span class="line"><span class="token comment"># usage: docker_process_sql sql_script</span></span>
<span class="line"><span class="token function-name function">docker_process_sql</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin class-name">set</span> +e</span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ELECTION&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-P9030</span> -h<span class="token variable">\${MASTER_FE_IP}</span> <span class="token parameter variable">--comments</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null</span>
<span class="line">    <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;FQDN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-P9030</span> -h<span class="token variable">\${MASTER_NODE_NAME}</span> <span class="token parameter variable">--comments</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null</span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function-name function">docker_setup_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin class-name">set</span> +e</span>
<span class="line">    <span class="token comment"># check fe status</span></span>
<span class="line">    <span class="token builtin class-name">local</span> <span class="token assign-left variable">is_fe_start</span><span class="token operator">=</span>false</span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">\${CURRENT_FE_IS_MASTER}</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        doris_note <span class="token string">&quot;Current FE is Master FE!  No need to register again！&quot;</span></span>
<span class="line">        <span class="token builtin class-name">return</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ELECTION&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            docker_process_sql <span class="token operator">&lt;&lt;&lt;</span><span class="token string">&quot;alter system add FOLLOWER &#39;<span class="token variable">\${CURRENT_FE_IP}</span>:<span class="token variable">\${CURRENT_FE_EDIT_PORT}</span>&#39;&quot;</span></span>
<span class="line">        <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;FQDN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            docker_process_sql <span class="token operator">&lt;&lt;&lt;</span><span class="token string">&quot;alter system add FOLLOWER &#39;<span class="token variable">\${CURRENT_NODE_NAME}</span>:<span class="token variable">\${CURRENT_FE_EDIT_PORT}</span>&#39;&quot;</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        <span class="token assign-left variable">register_fe_status</span><span class="token operator">=</span><span class="token variable">$?</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$register_fe_status</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            doris_note <span class="token string">&quot;FE successfully registered！&quot;</span></span>
<span class="line">            <span class="token assign-left variable">is_fe_start</span><span class="token operator">=</span>true</span>
<span class="line">            <span class="token builtin class-name">break</span></span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ELECTION&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                check_fe_status</span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$CURRENT_FE_ALREADY_EXISTS</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                doris_warn <span class="token string">&quot;Same frontend already exists! No need to register again！&quot;</span></span>
<span class="line">                <span class="token builtin class-name">break</span></span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$((</span>$i <span class="token operator">%</span> <span class="token number">20</span><span class="token variable">))</span></span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                doris_warn <span class="token string">&quot;register_fe_status: <span class="token variable">\${register_fe_status}</span>&quot;</span></span>
<span class="line">                doris_warn <span class="token string">&quot;FE failed registered!&quot;</span></span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$((</span>$i <span class="token operator">%</span> <span class="token number">20</span><span class="token variable">))</span></span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            doris_note <span class="token string">&quot;ADD FOLLOWER failed, retry.&quot;</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        <span class="token function">sleep</span> <span class="token number">1</span></span>
<span class="line">    <span class="token keyword">done</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token operator">!</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$is_fe_start</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        doris_error <span class="token string">&quot;Failed to register CURRENT_FE to FE！Tried 30 times！Maybe FE Start Failed！&quot;</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check whether the passed parameters are empty to avoid subsequent task execution failures. At the same time,</span></span>
<span class="line"><span class="token comment"># enumeration checks can fe added, such as checking whether a certain parameter appears repeatedly, etc.</span></span>
<span class="line"><span class="token function-name function">check_arg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$2</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        doris_error <span class="token string">&quot;<span class="token variable">$1</span> is null!&quot;</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token function-name function">check_fe_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin class-name">set</span> +e</span>
<span class="line">    <span class="token builtin class-name">declare</span> <span class="token parameter variable">-g</span> CURRENT_FE_ALREADY_EXISTS</span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">\${CURRENT_FE_IS_MASTER}</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        doris_note <span class="token string">&quot;Current FE is Master FE!  No need check fe status！&quot;</span></span>
<span class="line">        <span class="token builtin class-name">return</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$1</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ELECTION&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                docker_process_sql <span class="token operator">&lt;&lt;&lt;</span><span class="token string">&quot;show frontends&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;[[:space:]]<span class="token variable">\${MASTER_FE_IP}</span>[[:space:]]&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;[[:space:]]<span class="token variable">\${MASTER_FE_EDIT_PORT}</span>[[:space:]]&quot;</span></span>
<span class="line">            <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;FQDN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                docker_process_sql <span class="token operator">&lt;&lt;&lt;</span><span class="token string">&quot;show frontends&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;[[:space:]]<span class="token variable">\${MASTER_NODE_NAME}</span>[[:space:]]&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;[[:space:]]<span class="token variable">\${MASTER_FE_EDIT_PORT}</span>[[:space:]]&quot;</span></span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ELECTION&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                docker_process_sql <span class="token operator">&lt;&lt;&lt;</span><span class="token string">&quot;show frontends&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;[[:space:]]<span class="token variable">\${CURRENT_FE_IP}</span>[[:space:]]&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;[[:space:]]<span class="token variable">\${CURRENT_FE_EDIT_PORT}</span>[[:space:]]&quot;</span></span>
<span class="line">            <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;FQDN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                docker_process_sql <span class="token operator">&lt;&lt;&lt;</span><span class="token string">&quot;show frontends&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;[[:space:]]<span class="token variable">\${CURRENT_NODE_NAME}</span>[[:space:]]&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;[[:space:]]<span class="token variable">\${CURRENT_FE_EDIT_PORT}</span>[[:space:]]&quot;</span></span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        <span class="token assign-left variable">fe_join_status</span><span class="token operator">=</span><span class="token variable">$?</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">\${fe_join_status}</span>&quot;</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$1</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                doris_note <span class="token string">&quot;Master FE is started!&quot;</span></span>
<span class="line">            <span class="token keyword">else</span></span>
<span class="line">                doris_note <span class="token string">&quot;Verify that CURRENT_FE is registered to FE successfully&quot;</span></span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">            <span class="token assign-left variable">CURRENT_FE_ALREADY_EXISTS</span><span class="token operator">=</span>true</span>
<span class="line">            <span class="token builtin class-name">break</span></span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$((</span>$i <span class="token operator">%</span> <span class="token number">20</span><span class="token variable">))</span></span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$1</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                    doris_note <span class="token string">&quot;Master FE is not started, retry.&quot;</span></span>
<span class="line">                <span class="token keyword">else</span></span>
<span class="line">                    doris_warn <span class="token string">&quot;Verify that CURRENT_FE is registered to FE failed, retry.&quot;</span></span>
<span class="line">                <span class="token keyword">fi</span></span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$((</span>$i <span class="token operator">%</span> <span class="token number">20</span><span class="token variable">))</span></span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            doris_note <span class="token string">&quot;try session Master FE.&quot;</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        <span class="token function">sleep</span> <span class="token number">1</span></span>
<span class="line">    <span class="token keyword">done</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function-name function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    doris_note <span class="token string">&quot;Container stopped, running stop_fe script&quot;</span></span>
<span class="line">    <span class="token variable">\${DORIS_HOME}</span>/fe/bin/stop_fe.sh</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function-name function">_main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    docker_required_variables_env</span>
<span class="line">    <span class="token builtin class-name">trap</span> <span class="token string">&#39;cleanup&#39;</span> SIGTERM SIGINT</span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;K8S&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token variable">\${DORIS_HOME}</span>/fe/bin/start_fe.sh <span class="token parameter variable">--console</span> <span class="token operator">&amp;</span></span>
<span class="line">        <span class="token assign-left variable">child_pid</span><span class="token operator">=</span><span class="token variable">$!</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">        get_doris_fe_args</span>
<span class="line">        docker_setup_env</span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$DATABASE_ALREADY_EXISTS</span> <span class="token operator">==</span> <span class="token string">&quot;true&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$PRIORITY_NETWORKS_EXISTS</span> <span class="token operator">!=</span> <span class="token string">&quot;true&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ELECTION&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;RECOVERY&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                doris_note <span class="token string">&quot;start add_priority_networks&quot;</span></span>
<span class="line">                add_priority_networks <span class="token variable">$PRIORITY_NETWORKS</span></span>
<span class="line">            <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;FQDN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                doris_note <span class="token string">&quot;start add_fqdn_conf&quot;</span></span>
<span class="line">                add_fqdn_conf</span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        docker_setup_db</span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ELECTION&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            check_fe_status</span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        doris_note <span class="token string">&quot;Ready to start CURRENT_FE！&quot;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$RECOVERY</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            start_fe.sh <span class="token parameter variable">--console</span> <span class="token parameter variable">--metadata_failure_recovery</span> <span class="token operator">&amp;</span></span>
<span class="line">            <span class="token assign-left variable">child_pid</span><span class="token operator">=</span><span class="token variable">$!</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$CURRENT_FE_IS_MASTER</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">            <span class="token variable">\${DORIS_HOME}</span>/fe/bin/start_fe.sh <span class="token parameter variable">--console</span> <span class="token operator">&amp;</span></span>
<span class="line">            <span class="token assign-left variable">child_pid</span><span class="token operator">=</span><span class="token variable">$!</span></span>
<span class="line">        <span class="token keyword">else</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ELECTION&quot;</span> <span class="token operator">||</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;ASSIGN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                <span class="token variable">\${DORIS_HOME}</span>/fe/bin/start_fe.sh <span class="token parameter variable">--helper</span> <span class="token variable">\${MASTER_FE_IP}</span><span class="token builtin class-name">:</span><span class="token variable">\${MASTER_FE_EDIT_PORT}</span> <span class="token parameter variable">--console</span> <span class="token operator">&amp;</span></span>
<span class="line">            <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$RUN_TYPE</span> <span class="token operator">==</span> <span class="token string">&quot;FQDN&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">                <span class="token variable">\${DORIS_HOME}</span>/fe/bin/start_fe.sh <span class="token parameter variable">--helper</span> <span class="token variable">\${MASTER_NODE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">\${MASTER_FE_EDIT_PORT}</span> <span class="token parameter variable">--console</span> <span class="token operator">&amp;</span></span>
<span class="line">            <span class="token keyword">fi</span></span>
<span class="line">            <span class="token assign-left variable">child_pid</span><span class="token operator">=</span><span class="token variable">$!</span></span>
<span class="line">        <span class="token keyword">fi</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line">    <span class="token function">wait</span> <span class="token variable">$child_pid</span></span>
<span class="line">    <span class="token builtin class-name">exec</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token operator">!</span> _is_sourced<span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    _main <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-上传-doris-二进制文件" tabindex="-1"><a class="header-anchor" href="#_4-上传-doris-二进制文件"><span>4. 上传 doris 二进制文件</span></a></h4><ul><li>上传 apache-doris-2.0.13-bin-x64.tar.gz 到 <code>/data/doris/docker-build/fe/resource/</code></li><li>查看 FE 安装环境内容</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">tree /data/doris</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>结果：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">/data/doris</span>
<span class="line">└── docker-build</span>
<span class="line">    └── fe</span>
<span class="line">        ├── Dockerfile</span>
<span class="line">        └── resource</span>
<span class="line">            ├── apache-doris-2.0.13-bin-x64.tar.gz</span>
<span class="line">            └── init_fe.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-构建-fe-镜像" tabindex="-1"><a class="header-anchor" href="#_5-构建-fe-镜像"><span>5. 构建 FE 镜像</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">cd</span> /data/doris/docker-build/fe <span class="token operator">&amp;&amp;</span> <span class="token function">docker</span> build <span class="token builtin class-name">.</span> <span class="token parameter variable">-t</span> apache-doris-fe:2.0.13</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>结果：</p><p>ps：过程可能很久，需要等待~</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">[root@iZ0jl2zspvl2lbaflikgacZ fe]# cd /data/doris/docker-build/fe &amp;&amp; docker build . -t apache-doris:2.0.13-fe</span>
<span class="line">[+] Building 887.8s (10/10) FINISHED                                                                           </span>
<span class="line"> =&gt; [internal] load .dockerignore                                                                         0.0s</span>
<span class="line"> =&gt; =&gt; transferring context: 2B                                                                           0.0s</span>
<span class="line"> =&gt; [internal] load build definition from Dockerfile                                                      0.0s</span>
<span class="line"> =&gt; =&gt; transferring dockerfile: 1.40kB                                                                    0.0s</span>
<span class="line"> =&gt; [internal] load metadata for docker.io/library/openjdk:8u342-jdk                                      1.2s</span>
<span class="line"> =&gt; [1/5] FROM docker.io/library/openjdk:8u342-jdk@sha256:86e863cc57215cfb181bd319736d0baf625fe8f150577  23.6s</span>
<span class="line"> =&gt; =&gt; resolve docker.io/library/openjdk:8u342-jdk@sha256:86e863cc57215cfb181bd319736d0baf625fe8f150577f  0.0s</span>
<span class="line"> =&gt; =&gt; sha256:86e863cc57215cfb181bd319736d0baf625fe8f150577f9eb58bd937f5452cb8 1.04kB / 1.04kB            0.0s</span>
<span class="line"> =&gt; =&gt; sha256:3af2ac94130765b73fc8f1b42ffc04f77996ed8210c297fcfa28ca880ff0a217 1.79kB / 1.79kB            0.0s</span>
<span class="line"> =&gt; =&gt; sha256:2068746827ec1b043b571e4788693eab7e9b2a95301176512791f8c317a2816a 10.88MB / 10.88MB          2.1s</span>
<span class="line"> =&gt; =&gt; sha256:b273004037cc3af245d8e08cfbfa672b93ee7dcb289736c82d0b58936fb71702 7.81kB / 7.81kB            0.0s</span>
<span class="line"> =&gt; =&gt; sha256:001c52e26ad57e3b25b439ee0052f6692e5c0f2d5d982a00a8819ace5e521452 55.00MB / 55.00MB         12.4s</span>
<span class="line"> =&gt; =&gt; sha256:d9d4b9b6e964657da49910b495173d6c4f0d9bc47b3b44273cf82fd32723d165 5.16MB / 5.16MB            1.2s</span>
<span class="line"> =&gt; =&gt; sha256:9daef329d35093868ef75ac8b7c6eb407fa53abbcb3a264c218c2ec7bca716e6 54.58MB / 54.58MB         10.6s</span>
<span class="line"> =&gt; =&gt; sha256:d85151f15b6683b98f21c3827ac545188b1849efb14a1049710ebc4692de3dd5 5.42MB / 5.42MB            3.7s</span>
<span class="line"> =&gt; =&gt; sha256:52a8c426d30b691c4f7e8c4b438901ddeb82ff80d4540d5bbd49986376d85cc9 210B / 210B                3.9s</span>
<span class="line"> =&gt; =&gt; sha256:8754a66e005039a091c5ad0319f055be393c7123717b1f6fee8647c338ff3ceb 105.92MB / 105.92MB       18.5s</span>
<span class="line"> =&gt; =&gt; extracting sha256:001c52e26ad57e3b25b439ee0052f6692e5c0f2d5d982a00a8819ace5e521452                 2.9s</span>
<span class="line"> =&gt; =&gt; extracting sha256:d9d4b9b6e964657da49910b495173d6c4f0d9bc47b3b44273cf82fd32723d165                 0.2s</span>
<span class="line"> =&gt; =&gt; extracting sha256:2068746827ec1b043b571e4788693eab7e9b2a95301176512791f8c317a2816a                 0.3s</span>
<span class="line"> =&gt; =&gt; extracting sha256:9daef329d35093868ef75ac8b7c6eb407fa53abbcb3a264c218c2ec7bca716e6                 2.5s</span>
<span class="line"> =&gt; =&gt; extracting sha256:d85151f15b6683b98f21c3827ac545188b1849efb14a1049710ebc4692de3dd5                 0.2s</span>
<span class="line"> =&gt; =&gt; extracting sha256:52a8c426d30b691c4f7e8c4b438901ddeb82ff80d4540d5bbd49986376d85cc9                 0.0s</span>
<span class="line"> =&gt; =&gt; extracting sha256:8754a66e005039a091c5ad0319f055be393c7123717b1f6fee8647c338ff3ceb                 2.7s</span>
<span class="line"> =&gt; [internal] load build context                                                                        14.3s</span>
<span class="line"> =&gt; =&gt; transferring context: 2.69GB                                                                      14.3s</span>
<span class="line"> =&gt; [2/5] ADD ./resource/apache-doris-2.0.13-bin-x64.tar.gz /opt/                                        38.5s</span>
<span class="line"> =&gt; [3/5] RUN apt-get update &amp;&amp;     apt-get install -y default-mysql-client &amp;&amp;     apt-get clean &amp;&amp;     804.7s</span>
<span class="line"> =&gt; [4/5] ADD ./resource/init_fe.sh /opt/apache-doris/fe/bin                                              0.1s </span>
<span class="line"> =&gt; [5/5] RUN chmod 755 /opt/apache-doris/fe/bin/init_fe.sh                                               0.3s </span>
<span class="line"> =&gt; exporting to image                                                                                   19.3s </span>
<span class="line"> =&gt; =&gt; exporting layers                                                                                  19.3s </span>
<span class="line"> =&gt; =&gt; writing image sha256:e1f19d9b661d04cdcb1749ce04b365f51ee2de6a83f3c1a5bb781ccdd9842877              0.0s </span>
<span class="line"> =&gt; =&gt; naming to docker.io/library/apache-doris:2.0.13-fe                                                 0.0s </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="构建-be-镜像" tabindex="-1"><a class="header-anchor" href="#构建-be-镜像"><span>构建 BE 镜像</span></a></h3><h4 id="_1-be-镜像目录" tabindex="-1"><a class="header-anchor" href="#_1-be-镜像目录"><span>1. BE 镜像目录</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/doris/docker-build/be/resource</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>目录结构</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">└── docker-build                                                // 构建根目录 </span>
<span class="line">    └── be                                                      // BE 构建目录</span>
<span class="line">        ├── Dockerfile                                          // dockerfile 脚本</span>
<span class="line">        └── resource                                            // 资源目录</span>
<span class="line">            ├── init_be.sh                                      // 启动及注册脚本</span>
<span class="line">            └── apache-doris-2.0.3-bin.tar.gz                   // 二进制程序包</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-dockerfile-1" tabindex="-1"><a class="header-anchor" href="#_2-dockerfile-1"><span>2. Dockerfile</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># 创建文件</span>
<span class="line">touch /data/doris/docker-build/be/Dockerfile</span>
<span class="line"># 编辑文件</span>
<span class="line">vim /data/doris/docker-build/be/Dockerfile</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Dockerfile 内容</li></ul><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token comment"># 选择基础镜像</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> openjdk:8u342-jdk</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置环境变量</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENV</span> JAVA_HOME=<span class="token string">&quot;/usr/local/openjdk-8/&quot;</span> </span></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENV</span> PATH=<span class="token string">&quot;/opt/apache-doris/be/bin:$PATH&quot;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 下载软件至镜像内，可根据需要替换</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">ADD</span> ./resource/apache-doris-2.0.13-bin-x64.tar.gz /opt/</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get install -y default-mysql-client &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get clean &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    mkdir /opt/apache-doris &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    cd /opt &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    mv apache-doris-2.0.13-bin-x64/be /opt/apache-doris/</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">ADD</span> ./resource/init_be.sh /opt/apache-doris/be/bin</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> chmod 755 /opt/apache-doris/be/bin/init_be.sh</span></span>
<span class="line"></span>
<span class="line"><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/opt/apache-doris/be/bin/init_be.sh&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-init-be-sh" tabindex="-1"><a class="header-anchor" href="#_3-init-be-sh"><span>3. init_be.sh</span></a></h4><ul><li>创建 init_be.sh</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 创建init_be.sh</span></span>
<span class="line"><span class="token function">touch</span> /data/doris/docker-build/be/resource/init_be.sh</span>
<span class="line"><span class="token comment"># 编辑init_be.sh</span></span>
<span class="line"><span class="token function">vim</span> /data/doris/docker-build/be/resource/init_be.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-上传-doris-二进制文件-1" tabindex="-1"><a class="header-anchor" href="#_4-上传-doris-二进制文件-1"><span>4. 上传 doris 二进制文件</span></a></h4><ul><li>上传 apache-doris-2.0.13-bin-x64.tar.gz 到 <code>/data/doris/docker-build/be/resource/</code></li><li>查看 BE 安装环境内容</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">tree /data/doris/docker-build/be</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>结果：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">[root@iZ0jl2zspvl2lbaflikgacZ resource]# tree /data/doris/docker-build/be</span>
<span class="line">/data/doris/docker-build/be</span>
<span class="line">├── Dockerfile</span>
<span class="line">└── resource</span>
<span class="line">    ├── apache-doris-2.0.13-bin-x64.tar.gz</span>
<span class="line">    └── init_be.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-构建-be-镜像" tabindex="-1"><a class="header-anchor" href="#_5-构建-be-镜像"><span>5. 构建 BE 镜像</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">cd</span> /data/doris/docker-build/be <span class="token operator">&amp;&amp;</span> <span class="token function">docker</span> build <span class="token builtin class-name">.</span> <span class="token parameter variable">-t</span> apache-doris-be:2.0.13</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>结果：</p><p>ps：过程可能很久，需要等待~</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">[root@iZ0jl2zspvl2lbaflikgacZ be]# cd /data/doris/docker-build/be &amp;&amp; docker build . -t apache-doris:2.0.13-be</span>
<span class="line">[+] Building 561.6s (10/10) FINISHED                                                                                               </span>
<span class="line"> =&gt; [internal] load build definition from Dockerfile                                                                          0.0s</span>
<span class="line"> =&gt; =&gt; transferring dockerfile: 652B                                                                                          0.0s</span>
<span class="line"> =&gt; [internal] load .dockerignore                                                                                             0.0s</span>
<span class="line"> =&gt; =&gt; transferring context: 2B                                                                                               0.0s</span>
<span class="line"> =&gt; [internal] load metadata for docker.io/library/openjdk:8u342-jdk                                                          1.2s</span>
<span class="line"> =&gt; [1/5] FROM docker.io/library/openjdk:8u342-jdk@sha256:86e863cc57215cfb181bd319736d0baf625fe8f150577f9eb58bd937f5452cb8    0.0s</span>
<span class="line"> =&gt; [internal] load build context                                                                                             0.0s</span>
<span class="line"> =&gt; =&gt; transferring context: 135B                                                                                             0.0s</span>
<span class="line"> =&gt; CACHED [2/5] ADD ./resource/apache-doris-2.0.13-bin-x64.tar.gz /opt/                                                      0.0s</span>
<span class="line"> =&gt; [3/5] RUN apt-get update &amp;&amp;     apt-get install -y default-mysql-client &amp;&amp;     apt-get clean &amp;&amp;     mkdir /opt/apache-  546.2s</span>
<span class="line"> =&gt; [4/5] ADD ./resource/init_be.sh /opt/apache-doris/be/bin                                                                  0.1s</span>
<span class="line"> =&gt; [5/5] RUN chmod 755 /opt/apache-doris/be/bin/init_be.sh                                                                   0.3s </span>
<span class="line"> =&gt; exporting to image                                                                                                       13.8s </span>
<span class="line"> =&gt; =&gt; exporting layers                                                                                                      13.8s </span>
<span class="line"> =&gt; =&gt; writing image sha256:4f420522480e7c131d7863430c84c0526ff5f64ef8f8c6c27d0bb971c76eec5b                                  0.0s </span>
<span class="line"> =&gt; =&gt; naming to docker.io/library/apache-doris:2.0.13-be                                                                     0.0s</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="推送-harbor" tabindex="-1"><a class="header-anchor" href="#推送-harbor"><span>推送 harbor</span></a></h3><h4 id="_1-登录-harbor" tabindex="-1"><a class="header-anchor" href="#_1-登录-harbor"><span>1. 登录 harbor</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> login <span class="token parameter variable">-u</span> <span class="token function">service</span> <span class="token parameter variable">-p</span> dEdeF2bAFa3C3A2e dev.huiyisoft.cn:9445 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-标记镜像" tabindex="-1"><a class="header-anchor" href="#_2-标记镜像"><span>2. 标记镜像</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> tag apache-doris-be:2.0.13 dev.huiyisoft.cn:9445/library/apache-doris-be:2.0.13</span>
<span class="line"><span class="token function">docker</span> tag apache-doris-fe:2.0.13 dev.huiyisoft.cn:9445/library/apache-doris-fe:2.0.13</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-推送镜像" tabindex="-1"><a class="header-anchor" href="#_3-推送镜像"><span>3. 推送镜像</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> push dev.huiyisoft.cn:9445/library/apache-doris-be:2.0.13</span>
<span class="line"><span class="token function">docker</span> push dev.huiyisoft.cn:9445/library/apache-doris-fe:2.0.13</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="doris-部署" tabindex="-1"><a class="header-anchor" href="#doris-部署"><span>Doris 部署</span></a></h2><p><strong>软件环境</strong></p><table><thead><tr><th>软件</th><th>版本</th></tr></thead><tbody><tr><td>Docker</td><td>20.0 及以上</td></tr><tr><td>docker-compose</td><td>20.1 及以上</td></tr></tbody></table><p><strong>硬件环境</strong></p><table><thead><tr><th>配置类型</th><th>硬件信息</th><th>最大运行集群规模</th></tr></thead><tbody><tr><td>最低配置</td><td>2C 4G</td><td>1FE 1BE</td></tr><tr><td>推荐配置</td><td>4C 16G</td><td>3FE 3BE</td></tr></tbody></table><h3 id="系统参数配置" tabindex="-1"><a class="header-anchor" href="#系统参数配置"><span>系统参数配置</span></a></h3><p>修改宿主机<code>vm.max_map_count</code>配置</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">vm.max_map_count</span><span class="token operator">=</span><span class="token number">2000000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,69)]))}const i=n(t,[["render",o],["__file","03-Doris.html.vue"]]),r=JSON.parse('{"path":"/docs/database/03-Doris.html","title":"Doris 安装","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"Doris 镜像构建","slug":"doris-镜像构建","link":"#doris-镜像构建","children":[{"level":3,"title":"软硬件要求","slug":"软硬件要求","link":"#软硬件要求","children":[]},{"level":3,"title":"构建 FE 镜像","slug":"构建-fe-镜像","link":"#构建-fe-镜像","children":[]},{"level":3,"title":"构建 BE 镜像","slug":"构建-be-镜像","link":"#构建-be-镜像","children":[]},{"level":3,"title":"推送 harbor","slug":"推送-harbor","link":"#推送-harbor","children":[]}]},{"level":2,"title":"Doris 部署","slug":"doris-部署","link":"#doris-部署","children":[{"level":3,"title":"系统参数配置","slug":"系统参数配置","link":"#系统参数配置","children":[]}]}],"git":{"updatedTime":1734338014000,"contributors":[{"name":"wangxiaoquan","email":"wxq","commits":1}]},"filePathRelative":"docs/database/03-Doris.md"}');export{i as comp,r as data};
