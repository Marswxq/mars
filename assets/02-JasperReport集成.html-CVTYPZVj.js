import{_ as l,c as i,a as s,b as p,w as t,d as c,r as u,o as k,e}from"./app-CKtXyHQO.js";const r={},d={class:"table-of-contents"},m=["src"];function v(o,n){const a=u("router-link");return k(),i("div",null,[n[5]||(n[5]=s("h1",{id:"jasperreport-集成",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#jasperreport-集成"},[s("span",null,"JasperReport 集成")])],-1)),n[6]||(n[6]=s("p",null,[s("strong",null,"目录")],-1)),s("nav",d,[s("ul",null,[s("li",null,[p(a,{to:"#依赖"},{default:t(()=>n[0]||(n[0]=[e("依赖")])),_:1})]),s("li",null,[p(a,{to:"#配置类"},{default:t(()=>n[1]||(n[1]=[e("配置类")])),_:1})]),s("li",null,[p(a,{to:"#工具类"},{default:t(()=>n[2]||(n[2]=[e("工具类")])),_:1})]),s("li",null,[p(a,{to:"#中文显示"},{default:t(()=>n[3]||(n[3]=[e("中文显示")])),_:1})]),s("li",null,[p(a,{to:"#connection引发的血案"},{default:t(()=>n[4]||(n[4]=[e("Connection引发的血案")])),_:1})])])]),n[7]||(n[7]=c(`<h2 id="依赖" tabindex="-1"><a class="header-anchor" href="#依赖"><span>依赖</span></a></h2><p>版本根据springboot版本决定</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.sf.jasperreports<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jasperreports<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置类" tabindex="-1"><a class="header-anchor" href="#配置类"><span>配置类</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Slf4j</span></span>
<span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JasperReportConfig</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${mars.report.pdf.path:}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> pdfPath<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PDF_PATH</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> <span class="token constant">DATA_SOURCE</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">JasperReportConfig</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>pdfPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>pdfPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token constant">PDF_PATH</span> <span class="token operator">=</span> pdfPath<span class="token punctuation">;</span></span>
<span class="line">        <span class="token constant">DATA_SOURCE</span> <span class="token operator">=</span> dataSource<span class="token punctuation">;</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt;&gt;&gt;&gt; 加载报表pdfPath: {}&quot;</span><span class="token punctuation">,</span> pdfPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="工具类" tabindex="-1"><a class="header-anchor" href="#工具类"><span>工具类</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Slf4j</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JasperReportUtil</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PDF_EXPORT_PATH</span> <span class="token operator">=</span> <span class="token string">&quot;%s/%s.pdf&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 生成pdf报表</span>
<span class="line">     *</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">reportInputStream</span> 报表（.jrxml）</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">parameters</span>        报表参数</span>
<span class="line">     * <span class="token keyword">@return</span> pdf路径</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">generatePdf</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> reportInputStream<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>reportInputStream <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">&quot;报表模板不能为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">JasperReport</span> jasperReport <span class="token operator">=</span> <span class="token class-name">JasperCompileManager</span><span class="token punctuation">.</span><span class="token function">compileReport</span><span class="token punctuation">(</span>reportInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">JasperPrint</span> jasperPrint <span class="token operator">=</span> <span class="token class-name">JasperFillManager</span><span class="token punctuation">.</span><span class="token function">fillReport</span><span class="token punctuation">(</span>jasperReport<span class="token punctuation">,</span> parameters<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token constant">PDF_EXPORT_PATH</span><span class="token punctuation">,</span> <span class="token class-name">JasperReportConfig</span><span class="token punctuation">.</span><span class="token constant">PDF_PATH</span><span class="token punctuation">,</span> <span class="token class-name">JasperReportUtil</span><span class="token punctuation">.</span><span class="token function">buildFileName</span><span class="token punctuation">(</span>jasperReport<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">JasperExportManager</span><span class="token punctuation">.</span><span class="token function">exportReportToPdfFile</span><span class="token punctuation">(</span>jasperPrint<span class="token punctuation">,</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> filePath<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JRException</span> <span class="token operator">|</span> <span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;生成pdf报表失败&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printPdf</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> reportInputStream<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> parameters<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>reportInputStream <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">&quot;报表模板不能为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">JasperReport</span> jasperReport <span class="token operator">=</span> <span class="token class-name">JasperCompileManager</span><span class="token punctuation">.</span><span class="token function">compileReport</span><span class="token punctuation">(</span>reportInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">JasperPrint</span> jasperPrint <span class="token operator">=</span> <span class="token class-name">JasperFillManager</span><span class="token punctuation">.</span><span class="token function">fillReport</span><span class="token punctuation">(</span>jasperReport<span class="token punctuation">,</span> parameters<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//以附件形式保存文件</span></span>
<span class="line">            <span class="token class-name">String</span> generateFileName <span class="token operator">=</span> jasperReport<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.pdf&quot;</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//设置http的文件类型及编码方式</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/pdf;charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//设置下载的文件名称 名称含有中文的话需要用URLEncoder进行编码</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-disposition&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attachment;filename=&quot;</span> <span class="token operator">+</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>generateFileName<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">JasperExportManager</span><span class="token punctuation">.</span><span class="token function">exportReportToPdfStream</span><span class="token punctuation">(</span>jasperPrint<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JRException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;生成pdf报表失败&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>out <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                    out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;生成pdf关闭流错误&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printXlsx</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> reportInputStream<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> parameters<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>reportInputStream <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">&quot;报表模板不能为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">JasperReport</span> jasperReport <span class="token operator">=</span> <span class="token class-name">JasperCompileManager</span><span class="token punctuation">.</span><span class="token function">compileReport</span><span class="token punctuation">(</span>reportInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">JasperPrint</span> jasperPrint <span class="token operator">=</span> <span class="token class-name">JasperFillManager</span><span class="token punctuation">.</span><span class="token function">fillReport</span><span class="token punctuation">(</span>jasperReport<span class="token punctuation">,</span> parameters<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//以附件形式保存文件</span></span>
<span class="line">            <span class="token class-name">String</span> generateFileName <span class="token operator">=</span> jasperReport<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.xlsx&quot;</span><span class="token punctuation">;</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/vnd.ms-excel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-disposition&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attachment; filename=&quot;</span></span>
<span class="line">                    <span class="token operator">+</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>generateFileName<span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">SimpleXlsxReportConfiguration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleXlsxReportConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            conf<span class="token punctuation">.</span><span class="token function">setWhitePageBackground</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            conf<span class="token punctuation">.</span><span class="token function">setDetectCellType</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">JRXlsxExporter</span> exporter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JRXlsxExporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            exporter<span class="token punctuation">.</span><span class="token function">setConfiguration</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//设置输入项</span></span>
<span class="line">            <span class="token class-name">ExporterInput</span> exporterInput <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleExporterInput</span><span class="token punctuation">(</span>jasperPrint<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            exporter<span class="token punctuation">.</span><span class="token function">setExporterInput</span><span class="token punctuation">(</span>exporterInput<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//设置输出项</span></span>
<span class="line">            out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">OutputStreamExporterOutput</span> exporterOutput <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleOutputStreamExporterOutput</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            exporter<span class="token punctuation">.</span><span class="token function">setExporterOutput</span><span class="token punctuation">(</span>exporterOutput<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            exporter<span class="token punctuation">.</span><span class="token function">exportReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">JRException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;生成excel报表失败&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>out <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                    out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;生成excel关闭流错误&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">buildFileName</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// yyyyMMddHHmmssSSS 暂时认为时间到毫秒，文件不会重复</span></span>
<span class="line">        <span class="token keyword">return</span> fileName <span class="token operator">+</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">dateSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">DatePattern</span><span class="token punctuation">.</span><span class="token constant">PURE_DATETIME_MS_PATTERN</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">JasperReportConfig</span><span class="token punctuation">.</span><span class="token constant">DATA_SOURCE</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataSource <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">&quot;获取报表数据源失败，数据源为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Connection</span> connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">&quot;获取报表数据库连接失败,数据库连接为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">return</span> connection<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">&quot;获取报表数据库连接失败&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="中文显示" tabindex="-1"><a class="header-anchor" href="#中文显示"><span>中文显示</span></a></h2><ol><li>在 resources 下创建jasperreports_extension.properties，内容如下</li></ol><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">net.sf.jasperreports.extension.registry.factory.simple.font.families</span><span class="token punctuation">=</span><span class="token value attr-value">net.sf.jasperreports.engine.fonts.SimpleFontExtensionsRegistryFactory</span></span>
<span class="line"><span class="token key attr-name">net.sf.jasperreports.extension.simple.font.families.lobstertwo</span><span class="token punctuation">=</span><span class="token value attr-value">static/font/fonts.xml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p>在 resources 下创建 static/front 文件夹</p></li><li><p>在 font 下创建 fronts.xml，内容如下</p></li></ol><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fontFamilies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fontFamily</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>华文宋体<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>normal</span><span class="token punctuation">&gt;</span></span>static/font/STSONG.TTF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>normal</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bold</span><span class="token punctuation">&gt;</span></span>static/font/STSONG.TTF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bold</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>italic</span><span class="token punctuation">&gt;</span></span>static/font/STSONG.TTF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>italic</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boldItalic</span><span class="token punctuation">&gt;</span></span>static/font/STSONG.TTF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boldItalic</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pdfEncoding</span><span class="token punctuation">&gt;</span></span>Identity-H<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pdfEncoding</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pdfEmbedded</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pdfEmbedded</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exportFonts</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>export</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>net.sf.jasperreports.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#39;华文宋体&#39;, Arial, Helvetica, sans-serif<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>export</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>export</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>net.sf.jasperreports.xhtml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#39;华文宋体&#39;, Arial, Helvetica, sans-serif<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>export</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exportFonts</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fontFamily</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fontFamily</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>微软雅黑<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>normal</span><span class="token punctuation">&gt;</span></span>static/font/msyh.ttf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>normal</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bold</span><span class="token punctuation">&gt;</span></span>static/font/msyh.ttf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bold</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>italic</span><span class="token punctuation">&gt;</span></span>static/font/msyh.ttf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>italic</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boldItalic</span><span class="token punctuation">&gt;</span></span>static/font/msyh.ttf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boldItalic</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pdfEncoding</span><span class="token punctuation">&gt;</span></span>Identity-H<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pdfEncoding</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pdfEmbedded</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pdfEmbedded</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fontFamily</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fontFamilies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>在 front 下存放放 ttf 字体</li></ol>`,13)),s("img",{src:o.$withBase("/images/jasper/中文显示.png"),alt:"中文显示"},null,8,m),n[8]||(n[8]=c(`<h2 id="connection引发的血案" tabindex="-1"><a class="header-anchor" href="#connection引发的血案"><span>Connection引发的血案</span></a></h2><p>由于jasper官方提供的api需要指定<code>Connection</code>，所以想当然的<code>DataSource.getConnection()</code> ，刚才开测试报表正常，但是过段时间发现报表无法打印，并且服务开始报错，异常信息如下:</p><div class="language-log line-numbers-mode" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token exception javastacktrace language-javastacktrace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>NullPointerException<span class="token punctuation">:</span> null</span>
<span class="line">        <span class="token keyword">at</span> com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>ConnectionImpl<span class="token punctuation">.</span><span class="token function">getServerVersion</span><span class="token punctuation">(</span>ConnectionImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span>3312<span class="token punctuation">)</span> ~[mysql-connector-java-5<span class="token punctuation">.</span>1<span class="token punctuation">.</span>25<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>?]</span>
<span class="line">        <span class="token keyword">at</span> com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>DatabaseMetaData<span class="token punctuation">.</span><span class="token function">getDatabaseProductVersion</span><span class="token punctuation">(</span>DatabaseMetaData<span class="token punctuation">.</span>java<span class="token punctuation">:</span>3015<span class="token punctuation">)</span> ~[mysql-connector-java-5<span class="token punctuation">.</span>1<span class="token punctuation">.</span>25<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>?]</span>
<span class="line">        <span class="token keyword">at</span> com<span class="token punctuation">.</span>mchange<span class="token punctuation">.</span>v2<span class="token punctuation">.</span>c3p0<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>NewProxyDatabaseMetaData<span class="token punctuation">.</span><span class="token function">getDatabaseProductVersion</span><span class="token punctuation">(</span>NewProxyDatabaseMetaData<span class="token punctuation">.</span>java<span class="token punctuation">:</span>356<span class="token punctuation">)</span> ~[c3p0-0<span class="token punctuation">.</span>9<span class="token punctuation">.</span>5<span class="token punctuation">.</span>2<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>0<span class="token punctuation">.</span>9<span class="token punctuation">.</span>5<span class="token punctuation">.</span>2]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>query<span class="token punctuation">.</span>JRJdbcQueryExecuter<span class="token punctuation">.</span>&lt;init&gt;<span class="token punctuation">(</span>JRJdbcQueryExecuter<span class="token punctuation">.</span>java<span class="token punctuation">:</span>155<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>query<span class="token punctuation">.</span>JRJdbcQueryExecuterFactory<span class="token punctuation">.</span><span class="token function">createQueryExecuter</span><span class="token punctuation">(</span>JRJdbcQueryExecuterFactory<span class="token punctuation">.</span>java<span class="token punctuation">:</span>219<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>query<span class="token punctuation">.</span>QueryExecuterFactory<span class="token punctuation">.</span><span class="token function">createQueryExecuter</span><span class="token punctuation">(</span>QueryExecuterFactory<span class="token punctuation">.</span>java<span class="token punctuation">:</span>109<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>fill<span class="token punctuation">.</span>JRFillDataset<span class="token punctuation">.</span><span class="token function">createQueryDatasource</span><span class="token punctuation">(</span>JRFillDataset<span class="token punctuation">.</span>java<span class="token punctuation">:</span>1260<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>fill<span class="token punctuation">.</span>JRFillDataset<span class="token punctuation">.</span><span class="token function">initDatasource</span><span class="token punctuation">(</span>JRFillDataset<span class="token punctuation">.</span>java<span class="token punctuation">:</span>732<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>fill<span class="token punctuation">.</span>BaseReportFiller<span class="token punctuation">.</span><span class="token function">setParameters</span><span class="token punctuation">(</span>BaseReportFiller<span class="token punctuation">.</span>java<span class="token punctuation">:</span>457<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>fill<span class="token punctuation">.</span>JRBaseFiller<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>JRBaseFiller<span class="token punctuation">.</span>java<span class="token punctuation">:</span>585<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>fill<span class="token punctuation">.</span>BaseReportFiller<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>BaseReportFiller<span class="token punctuation">.</span>java<span class="token punctuation">:</span>414<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>fill<span class="token punctuation">.</span>JRFiller<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>JRFiller<span class="token punctuation">.</span>java<span class="token punctuation">:</span>120<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>fill<span class="token punctuation">.</span>JRFiller<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>JRFiller<span class="token punctuation">.</span>java<span class="token punctuation">:</span>103<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>JasperFillManager<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>JasperFillManager<span class="token punctuation">.</span>java<span class="token punctuation">:</span>530<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span>
<span class="line">        <span class="token keyword">at</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>jasperreports<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>JasperFillManager<span class="token punctuation">.</span><span class="token function">fillReport</span><span class="token punctuation">(</span>JasperFillManager<span class="token punctuation">.</span>java<span class="token punctuation">:</span>954<span class="token punctuation">)</span> ~[jasperreports-6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>jar!/<span class="token punctuation">:</span>6<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0-6d93193241dd8cc42629e188b94f9e0bc5722efd]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结合异常堆栈，很明显是没有连上数据库。但是服务开始好用，为什么突然不好用了？</p><p>经过一系列的排查：不是驱动-&gt;不是mysql连接数、线程池、进程数-&gt;what&#39;s the fk?</p><p>突然想到<code>Datasoure</code>连接池不可能为空，那么<code>Connection</code>怎么可能连不上了呢，难道说...空了？</p><p>fk，<code>Datasoure</code>有个东西叫做最大空闲时长，如果超过这个时长。。。。</p><p>好吧，以后每次<code>DataSource.getConnection()</code>，剩下的交给<code>Datasoure</code>管理。</p>`,8))])}const b=l(r,[["render",v],["__file","02-JasperReport集成.html.vue"]]),f=JSON.parse('{"path":"/docs/jasper/02-JasperReport%E9%9B%86%E6%88%90.html","title":"JasperReport 集成","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"依赖","slug":"依赖","link":"#依赖","children":[]},{"level":2,"title":"配置类","slug":"配置类","link":"#配置类","children":[]},{"level":2,"title":"工具类","slug":"工具类","link":"#工具类","children":[]},{"level":2,"title":"中文显示","slug":"中文显示","link":"#中文显示","children":[]},{"level":2,"title":"Connection引发的血案","slug":"connection引发的血案","link":"#connection引发的血案","children":[]}],"git":{"updatedTime":1734338014000,"contributors":[{"name":"wangxiaoquan","email":"wxq","commits":1}]},"filePathRelative":"docs/jasper/02-JasperReport集成.md"}');export{b as comp,f as data};
